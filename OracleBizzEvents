subscriptionId="$(az account show --query id -o tsv)"
location=westeurope
resourcegroup=Oracle
topicname=oracle
crsendpoint=https://oracle-bizz-crs.azurewebsites.net
payendpoint=https://oracle-bizz-pay.azurewebsites.net
postendpoint=https://connect-post.azurewebsites.net

az eventgrid topic delete -g $resourcegroup --name $topicname

az eventgrid topic create --name $topicname -l $location -g $resourcegroup

az eventgrid event-subscription create \
  --source-resource-id "/subscriptions/$subscriptionId/resourceGroups/$resourcegroup/providers/Microsoft.EventGrid/topics/$topicname" \
  --name BusinessPrepared \
  --endpoint $crsendpoint \
  --included-event-types "Oracle.Business.Prepared"
  
az eventgrid event-subscription create \
  --source-resource-id "/subscriptions/$subscriptionId/resourceGroups/$resourcegroup/providers/Microsoft.EventGrid/topics/$topicname" \
  --name RefreshPrepared \
  --endpoint $crsendpoint \
  --included-event-types "Oracle.Refresh.Prepared"
  
az eventgrid event-subscription create \
  --source-resource-id "/subscriptions/$subscriptionId/resourceGroups/$resourcegroup/providers/Microsoft.EventGrid/topics/$topicname" \
  --name ProxyProcessed \
  --endpoint $postendpoint \
  --included-event-types "Oracle.Proxy.Processed"
    
az eventgrid event-subscription create \
  --source-resource-id "/subscriptions/$subscriptionId/resourceGroups/$resourcegroup/providers/Microsoft.EventGrid/topics/$topicname" \
  --name BusinessProcessed \
  --endpoint $postendpoint \
  --included-event-types "Oracle.Business.Processed"
      
az eventgrid event-subscription create \
  --source-resource-id "/subscriptions/$subscriptionId/resourceGroups/$resourcegroup/providers/Microsoft.EventGrid/topics/$topicname" \
  --name ReservationCommit \
  --endpoint $postendpoint \
  --included-event-types "Oracle.Commit.Requested"
